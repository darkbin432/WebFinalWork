<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hele.hzjs.persistence.XuanjiaoDao">

    <select id="getMany" parameterType="int" resultType="com.hele.hzjs.model.Xuanjiao">
		select * from xuanjiao
		where status = 1
		order by id desc
		limit #{num};
	</select>

    <select id="getManyIndex" parameterType="int" resultType="com.hele.hzjs.model.Xuanjiao">
		select * from xuanjiao
		where status = 1 and type = 3
		order by id desc
		limit #{num};
	</select>

    <select id="getOne" parameterType="int" resultType="com.hele.hzjs.model.Xuanjiao">
		SELECT *,
        (SELECT organization.name
        FROM organization, organization_scope_relationship
        WHERE xuanjiao.create_member_scope_id = organization_scope_relationship.scope_id
        AND organization_scope_relationship.id = organization.id) AS create_organization_name
        FROM xuanjiao
		where status = 1 and id = #{id};
	</select>

    <insert id="insert" parameterType="com.hele.hzjs.model.Xuanjiao" useGeneratedKeys="true" keyProperty="id">
		insert into xuanjiao(create_member_scope_id, video,name,type,attachment,pdf,pdfName,content,created_time,updated_time,version,status)
		values (#{createMemberScopeId},#{video}, #{name},#{type},#{attachment}, #{pdf}, #{pdfName}, #{content}, now(),now(),#{version},#{status});
	</insert>

    <update id="countRead" parameterType="int">
		update xuanjiao
		set read_count = read_count + 1
		where id = #{id};
	</update>

    <update id="updateInfo" parameterType="com.hele.hzjs.model.Xuanjiao">
        update xuanjiao
        set
        <if test="name!=null">
            name = #{name},
        </if>
        <if test="type!=null and type!=0">
            type = #{type},
        </if>
        <if test="attachment!=null">
            attachment = #{attachment},
        </if>
        <if test="pdf!=null">
            pdf = #{pdf},
        </if>
        <if test="pdfName!=null">
            pdfName = #{pdfName},
        </if>
        <if test="content!=null">
            content = #{content},
        </if>
        <if test="version!=null and version!=' ' ">
            version = #{version},
        </if>
        <if test="status!=null">
            status = #{status},
        </if>
        <if test="video!=null">
            video = #{video},
        </if>
        updated_time = now()
        where id = #{id};
    </update>


    <update id="deleteInfo" parameterType="int">
		update xuanjiao
		set status = 0,
		updated_time = now()
		where id = #{id};
	</update>

    <select id="getPageCount" parameterType="hashmap" resultType="int">
        SELECT COUNT(xuanjiao.id) FROM xuanjiao
        <where>
            xuanjiao.status = 1
            <if test="name!=null and name!='' ">
                AND xuanjiao.name like concat('%',#{name},'%')
            </if>
            <if test="type != null">
                AND xuanjiao.type = #{type}
            </if>
        </where>
    </select>

    <select id="selectXuanjiaoInfo" parameterType="hashmap" resultType="com.hele.hzjs.model.Xuanjiao">
        SELECT * FROM xuanjiao
        <where>
            xuanjiao.status = 1
            <if test="name!=null and name!='' ">
                AND xuanjiao.name like concat('%',#{name},'%')
            </if>
            <if test="type != null">
                AND xuanjiao.type = #{type}
            </if>
        </where>
        ORDER BY xuanjiao.id DESC
        <if test="offset!=null and size!=null">
            LIMIT #{offset},#{size}
        </if>
    </select>


    <sql id="whereAll">
        <where>
            xuanjiao.status = 1
            <if test="type != null">
                AND xuanjiao.type = #{type}
            </if>
        </where>
    </sql>
    <select id="selectAll" resultType="Xuanjiao">
        SELECT * FROM xuanjiao
        <include refid="whereAll" />
        order by id desc
        limit #{offset},#{size}
    </select>

    <select id="countAll" resultType="int">
        SELECT COUNT(xuanjiao.id) FROM xuanjiao
        <include refid="whereAll" />
    </select>
</mapper>